/**
 * @license
 * Cesium - https://github.com/CesiumGS/cesium
 * Version 1.134.1
 *
 * Copyright 2011-2022 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/CesiumGS/cesium/blob/main/LICENSE.md for full licensing details.
 */

import{a as g}from"./chunk-7OVFZFUW.js";import{d as W}from"./chunk-3EILNZLQ.js";import{b as h,h as F}from"./chunk-E4TKUNJP.js";import{a as V}from"./chunk-OGDEH66A.js";import{a as s,b as k,c as T,d as _}from"./chunk-PQMBL3WJ.js";import{a as O}from"./chunk-PBRHRBI3.js";import{a as H,b as r}from"./chunk-JOINT6ZY.js";import{e as l}from"./chunk-XFGB44SP.js";function z(e,t){r.typeOf.object("ellipsoid",e),this._ellipsoid=e,this._cameraPosition=new s,this._cameraPositionInScaledSpace=new s,this._distanceToLimbInScaledSpaceSquared=0,l(t)&&(this.cameraPosition=t)}Object.defineProperties(z.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(e){let o=this._ellipsoid.transformPositionToScaledSpace(e,this._cameraPositionInScaledSpace),n=s.magnitudeSquared(o)-1;s.clone(e,this._cameraPosition),this._cameraPositionInScaledSpace=o,this._distanceToLimbInScaledSpaceSquared=n}}});var L=new s;z.prototype.isPointVisible=function(e){let o=this._ellipsoid.transformPositionToScaledSpace(e,L);return A(o,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};z.prototype.isScaledSpacePointVisible=function(e){return A(e,this._cameraPositionInScaledSpace,this._distanceToLimbInScaledSpaceSquared)};var it=new s;z.prototype.isScaledSpacePointVisiblePossiblyUnderEllipsoid=function(e,t){let o=this._ellipsoid,n,i;return l(t)&&t<0&&o.minimumRadius>-t?(i=it,i.x=this._cameraPosition.x/(o.radii.x+t),i.y=this._cameraPosition.y/(o.radii.y+t),i.z=this._cameraPosition.z/(o.radii.z+t),n=i.x*i.x+i.y*i.y+i.z*i.z-1):(i=this._cameraPositionInScaledSpace,n=this._distanceToLimbInScaledSpaceSquared),A(e,i,n)};z.prototype.computeHorizonCullingPoint=function(e,t,o){return Z(this._ellipsoid,e,t,o)};var U=_.clone(_.UNIT_SPHERE);z.prototype.computeHorizonCullingPointPossiblyUnderEllipsoid=function(e,t,o,n){let i=v(this._ellipsoid,o,U);return Z(i,e,t,n)};z.prototype.computeHorizonCullingPointFromVertices=function(e,t,o,n,i){return Q(this._ellipsoid,e,t,o,n,i)};z.prototype.computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid=function(e,t,o,n,i,c){let a=v(this._ellipsoid,i,U);return Q(a,e,t,o,n,c)};var nt=[];z.prototype.computeHorizonCullingPointFromRectangle=function(e,t,o){r.typeOf.object("rectangle",e);let n=F.subsample(e,t,0,nt),i=W.fromPoints(n);if(!(s.magnitude(i.center)<.1*t.minimumRadius))return this.computeHorizonCullingPoint(i.center,n,o)};var at=new s;function v(e,t,o){if(l(t)&&t<0&&e.minimumRadius>-t){let n=s.fromElements(e.radii.x+t,e.radii.y+t,e.radii.z+t,at);e=_.fromCartesian3(n,o)}return e}function Z(e,t,o,n){r.typeOf.object("directionToPoint",t),r.defined("positions",o),l(n)||(n=new s);let i=X(e,t),c=0;for(let a=0,m=o.length;a<m;++a){let d=o[a],p=J(e,d,i);if(p<0)return;c=Math.max(c,p)}return K(i,c,n)}var E=new s;function Q(e,t,o,n,i,c){r.typeOf.object("directionToPoint",t),r.defined("vertices",o),r.typeOf.number("stride",n),l(c)||(c=new s),n=n??3,i=i??s.ZERO;let a=X(e,t),m=0;for(let d=0,p=o.length;d<p;d+=n){E.x=o[d]+i.x,E.y=o[d+1]+i.y,E.z=o[d+2]+i.z;let f=J(e,E,a);if(f<0)return;m=Math.max(m,f)}return K(a,m,c)}function A(e,t,o){let n=t,i=o,c=s.subtract(e,n,L),a=-s.dot(c,n);return!(i<0?a>0:a>i&&a*a/s.magnitudeSquared(c)>i)}var st=new s,ct=new s;function J(e,t,o){let n=e.transformPositionToScaledSpace(t,st),i=s.magnitudeSquared(n),c=Math.sqrt(i),a=s.divideByScalar(n,c,ct);i=Math.max(1,i),c=Math.max(1,c);let m=s.dot(a,o),d=s.magnitude(s.cross(a,o,a)),p=1/c,f=Math.sqrt(i-1)*p;return 1/(m*p-d*f)}function K(e,t,o){if(!(t<=0||t===1/0||t!==t))return s.multiplyByScalar(e,t,o)}var I=new s;function X(e,t){return s.equals(t,s.ZERO)?t:(e.transformPositionToScaledSpace(t,I),s.normalize(I,I))}var zt=z;var w={};w.getHeight=function(e,t,o){if(!Number.isFinite(t))throw new H("scale must be a finite number.");if(!Number.isFinite(o))throw new H("relativeHeight must be a finite number.");return(e-o)*t+o};var rt=new k;w.getPosition=function(e,t,o,n,i){let c=t.cartesianToCartographic(e,rt);if(!l(c))return s.clone(e,i);let a=w.getHeight(c.height,o,n);return s.fromRadians(c.longitude,c.latitude,a,t,i)};var Y=w;var mt={NONE:0,BITS12:1},S=Object.freeze(mt);var R=new s,dt=new s,y=new T,q=new h,ht=new h,lt=Math.pow(2,12);function u(e,t,o,n,i,c,a,m,d,p){let f=S.NONE,N,x;if(l(t)&&l(o)&&l(n)&&l(i)){let P=t.minimum,G=t.maximum,b=s.subtract(G,P,dt),B=n-o;Math.max(s.maximumComponent(b),B)<lt-1?f=S.BITS12:f=S.NONE,N=h.inverseTransformation(i,new h);let tt=s.negate(P,R);h.multiply(h.fromTranslation(tt,q),N,N);let C=R;C.x=1/b.x,C.y=1/b.y,C.z=1/b.z,h.multiply(h.fromScale(C,q),N,N),x=h.clone(i),h.setTranslation(x,s.ZERO,x),i=h.clone(i,new h);let et=h.fromTranslation(P,q),ot=h.fromScale(b,ht),D=h.multiply(et,ot,q);h.multiply(i,D,i),h.multiply(x,D,x)}this.quantization=f,this.minimumHeight=o,this.maximumHeight=n,this.center=s.clone(e),this.toScaledENU=N,this.fromScaledENU=i,this.matrix=x,this.hasVertexNormals=c??!1,this.hasWebMercatorT=a??!1,this.hasGeodeticSurfaceNormals=m??!1,this.exaggeration=d??1,this.exaggerationRelativeHeight=p??0,this.stride=0,this._offsetGeodeticSurfaceNormal=0,this._offsetVertexNormal=0,this._calculateStrideAndOffsets()}u.prototype.encode=function(e,t,o,n,i,c,a,m){r.typeOf.object("vertexBuffer",e),r.typeOf.number("bufferIndex",t),r.typeOf.object("position",o),r.typeOf.object("uv",n),r.typeOf.number("height",i);let d=n.x,p=n.y;if(this.quantization===S.BITS12){o=h.multiplyByPoint(this.toScaledENU,o,R),o.x=O.clamp(o.x,0,1),o.y=O.clamp(o.y,0,1),o.z=O.clamp(o.z,0,1);let f=this.maximumHeight-this.minimumHeight,N=O.clamp((i-this.minimumHeight)/f,0,1);T.fromElements(o.x,o.y,y);let x=g.compressTextureCoordinates(y);T.fromElements(o.z,N,y);let P=g.compressTextureCoordinates(y);T.fromElements(d,p,y);let G=g.compressTextureCoordinates(y);if(e[t++]=x,e[t++]=P,e[t++]=G,this.hasWebMercatorT){T.fromElements(a,0,y);let b=g.compressTextureCoordinates(y);e[t++]=b}}else e[t++]=o.x-this.center.x,e[t++]=o.y-this.center.y,e[t++]=o.z-this.center.z,e[t++]=i,e[t++]=d,e[t++]=p,this.hasWebMercatorT&&(e[t++]=a);return this.hasVertexNormals&&(e[t++]=g.octPackFloat(c)),this.hasGeodeticSurfaceNormals&&(e[t++]=m.x,e[t++]=m.y,e[t++]=m.z),t};var pt=new s,$=new s;u.prototype.addGeodeticSurfaceNormals=function(e,t,o){if(r.typeOf.object("oldBuffer",e),r.typeOf.object("newBuffer",t),r.typeOf.object("ellipsoid",o),this.hasGeodeticSurfaceNormals)return;let n=this.stride,i=e.length/n;this.hasGeodeticSurfaceNormals=!0,this._calculateStrideAndOffsets();let c=this.stride;for(let a=0;a<i;a++){for(let f=0;f<n;f++){let N=a*n+f,x=a*c+f;t[x]=e[N]}let m=this.decodePosition(t,a,pt),d=o.geodeticSurfaceNormal(m,$),p=a*c+this._offsetGeodeticSurfaceNormal;t[p]=d.x,t[p+1]=d.y,t[p+2]=d.z}};u.prototype.removeGeodeticSurfaceNormals=function(e,t){if(r.typeOf.object("oldBuffer",e),r.typeOf.object("newBuffer",t),!this.hasGeodeticSurfaceNormals)return;let o=this.stride,n=e.length/o;this.hasGeodeticSurfaceNormals=!1,this._calculateStrideAndOffsets();let i=this.stride;for(let c=0;c<n;c++)for(let a=0;a<i;a++){let m=c*o+a,d=c*i+a;t[d]=e[m]}};u.prototype.decodePosition=function(e,t,o){if(r.typeOf.object("buffer",e),r.typeOf.number("index",t),l(o)||(o=new s),t*=this.stride,this.quantization===S.BITS12){let n=g.decompressTextureCoordinates(e[t],y);o.x=n.x,o.y=n.y;let i=g.decompressTextureCoordinates(e[t+1],y);return o.z=i.x,h.multiplyByPoint(this.fromScaledENU,o,o)}return o.x=e[t],o.y=e[t+1],o.z=e[t+2],s.add(o,this.center,o)};u.prototype.getExaggeratedPosition=function(e,t,o){o=this.decodePosition(e,t,o);let n=this.exaggeration,i=this.exaggerationRelativeHeight;if(n!==1&&this.hasGeodeticSurfaceNormals){let a=this.decodeGeodeticSurfaceNormal(e,t,$),m=this.decodeHeight(e,t),d=Y.getHeight(m,n,i)-m;o.x+=a.x*d,o.y+=a.y*d,o.z+=a.z*d}return o};u.prototype.decodeTextureCoordinates=function(e,t,o){return r.typeOf.object("buffer",e),r.typeOf.number("index",t),l(o)||(o=new T),t*=this.stride,this.quantization===S.BITS12?g.decompressTextureCoordinates(e[t+2],o):T.fromElements(e[t+4],e[t+5],o)};u.prototype.decodeHeight=function(e,t){return r.typeOf.object("buffer",e),r.typeOf.number("index",t),t*=this.stride,this.quantization===S.BITS12?g.decompressTextureCoordinates(e[t+1],y).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:e[t+3]};u.prototype.decodeWebMercatorT=function(e,t){return r.typeOf.object("buffer",e),r.typeOf.number("index",t),t*=this.stride,this.quantization===S.BITS12?g.decompressTextureCoordinates(e[t+3],y).x:e[t+6]};u.prototype.getOctEncodedNormal=function(e,t,o){r.typeOf.object("buffer",e),r.typeOf.number("index",t),t=t*this.stride+this._offsetVertexNormal;let n=e[t]/256,i=Math.floor(n),c=(n-i)*256;return T.fromElements(i,c,o)};u.prototype.decodeGeodeticSurfaceNormal=function(e,t,o){return r.typeOf.object("buffer",e),r.typeOf.number("index",t),r.typeOf.object("result",o),t=t*this.stride+this._offsetGeodeticSurfaceNormal,o.x=e[t],o.y=e[t+1],o.z=e[t+2],o};u.prototype._calculateStrideAndOffsets=function(){let e=0;switch(this.quantization){case S.BITS12:e+=3;break;default:e+=6}this.hasWebMercatorT&&(e+=1),this.hasVertexNormals&&(this._offsetVertexNormal=e,e+=1),this.hasGeodeticSurfaceNormals&&(this._offsetGeodeticSurfaceNormal=e,e+=3),this.stride=e};var M={position3DAndHeight:0,textureCoordAndEncodedNormals:1,geodeticSurfaceNormal:2},j={compressed0:0,compressed1:1,geodeticSurfaceNormal:2};u.prototype.getAttributes=function(e){r.typeOf.object("buffer",e);let t=V.FLOAT,o=V.getSizeInBytes(t),n=this.stride*o,i=0,c=[];function a(m,d){c.push({index:m,vertexBuffer:e,componentDatatype:t,componentsPerAttribute:d,offsetInBytes:i,strideInBytes:n}),i+=d*o}if(this.quantization===S.NONE){a(M.position3DAndHeight,4);let m=2;m+=this.hasWebMercatorT?1:0,m+=this.hasVertexNormals?1:0,a(M.textureCoordAndEncodedNormals,m),this.hasGeodeticSurfaceNormals&&a(M.geodeticSurfaceNormal,3)}else{let m=this.hasWebMercatorT||this.hasVertexNormals,d=this.hasWebMercatorT&&this.hasVertexNormals;a(j.compressed0,m?4:3),d&&a(j.compressed1,1),this.hasGeodeticSurfaceNormals&&a(j.geodeticSurfaceNormal,3)}return c};u.prototype.getAttributeLocations=function(){return this.quantization===S.NONE?M:j};u.clone=function(e,t){if(l(e))return l(t)||(t=new u),t.quantization=e.quantization,t.minimumHeight=e.minimumHeight,t.maximumHeight=e.maximumHeight,t.center=s.clone(e.center),t.toScaledENU=h.clone(e.toScaledENU),t.fromScaledENU=h.clone(e.fromScaledENU),t.matrix=h.clone(e.matrix),t.hasVertexNormals=e.hasVertexNormals,t.hasWebMercatorT=e.hasWebMercatorT,t.hasGeodeticSurfaceNormals=e.hasGeodeticSurfaceNormals,t.exaggeration=e.exaggeration,t.exaggerationRelativeHeight=e.exaggerationRelativeHeight,t._calculateStrideAndOffsets(),t};var Dt=u;export{zt as a,Dt as b};
